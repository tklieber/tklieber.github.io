Plan du cours :

1. Introduction à JSON Web Tokens (JWTs)
- Qu'est-ce qu'un JWT et à quoi sert-il ?

- Comment fonctionnent les JWTs ?
2. Structure d'un JWT
- Qu'est-ce qu'un header JWT ?

- Qu'est-ce qu'un payload JWT ?

- Qu'est-ce qu'un signature JWT ?
3. Utilisation de JWTs
- Comment utiliser les JWTs pour authentifier l'accès à des ressources ?

- Comment utiliser les JWTs pour autoriser l'accès à des ressources ?
4. Signature de JWTs
- Comment signer un JWT ?

- Comment vérifier la signature d'un JWT ?
5. JWTs et sécurité
- Quels sont les risques liés à l'utilisation de JWTs ?

- Comment protéger les JWTs contre les attaques courantes ?
6. Exemples d'utilisation de JWTs
- Quelques exemples concrets d'utilisation de JWTs dans des applications web.

# Introduction et présentation en vidéo :

***script vidéo :***

Dans cette section, nous allons voir comment des problèmes de conception et une mauvaise gestion des JSON Web Token alias JWT peuvent rendre les applications web vulnérables à diverses attaques avec un impact fort qui pourrait être très précieuses pour une opération de Red Team.

Les **JSON Web token (JWTs)** sont un format **normalisé** pour envoyer des données JSON signées de manière cryptographique entre les systèmes.

Théoriquement, ils peuvent contenir n'importe quel type de données, mais le plus souvent
 ils sont utilisés pour envoyer des informations sur les utilisateurs dans le cadre de mécanismes d'authentification, de gestion de session et/ou de contrôle d'accès. Ces informations sur les utilisateurs sont dite "claims" (traduit littéralement par "réclamation" en français).

Contrairement aux token de session classiques, toutes les données dont un serveur a besoin sont stockées en client-side (côté client) dans le JWT.

Cela fait des JWTs un très bon choix pour les applications web hautement distribués où les utilisateurs doivent interagir de manière transparente avec plusieurs serveurs back-end.

Étant donné que les JWT sont implémenté dans des mechanismes crutial d'un service web, s'ils sont compromis ils peuvent potentiellement compromettre l'intégralité du site web et ses utilisateurs.



En réalité la spécification d'un JWT est initialement assez limité. En effet un JWT n'est enfaite qu'un format JSON pour représenter des "claims"  qui peut être transféré entre deux parties. Les spécifications d'un JWT est étendue par les spécifications JSON Web Signature où JWS et JSON Web Encryption où JWE.

En d'autres termes, un JWT est généralement un jeton JWS ou JWE. Lorsque l'on utilise le terme "JWT", il s'agit presque toujours d'un jeton JWS. Les JWE sont très similaires, sauf que le contenu  du jeton est chiffré plutôt que simplement encodé. 

JWT est donc un abus de language pour dire JWS.



Si vous n'êtes pas familier avec les JWT vous n'avez pas de soucis à vous faire, nous allons développer le fonctionnement de ces token mais aussi voire comment nous pouvons les exploiter lors d'opération de Red Team par exemple.



Composition des JWT :

composé de 3 parties :

- header : metadata : contient à minima algo  - *encoder en B64*

- payload (données) : les données nécessaires - *encoder en B64*

- signature : vérifie l'authenticité du token. En effet, le serveur qui émet le token génère généralement la signature en hachant le header et le payload. Dans certains cas, il chiffre également le résultat du hachage. Dans tous les cas, ce processus implique une clé de signature secrète. Ce mécanisme permet aux serveurs de vérifier qu'aucune des données contenues dans le jeton n'a été altérée depuis son émission:
  
  - Tout d'abord car la signature est directement dérivée du reste du jeton, la modification d'un seul octet de l'en-tête ou de la charge utile entraîne une signature non conforme.
  
  - Et puis sans connaître la clé de signature secrète du serveur, il ne devrait pas être possible de générer la signature correcte pour le header ou les données (payload).
  
  
  
  La signature peut se faire via des algorythme symétrique comme (HMAC SHA256) ou asymétrique (RSA-SHA256). La solidité du token repose sur le ou les secret(s) utilisés dans le JWT. Nous verrons cela dans la partie démo de ce cours.



Cette capture d'écran a été faite avec le site web JWT.io qui nous sera très utile pour la suite du cours.



Je vous laisse avec la partie écrite du cours qui contient des démontrations.



# Écrit :

# Place à la pratique

Dans cette partie nous allons nous interresser à l'exploitation des JSON Web Token. Dans un premier temps nous utiliserons hashcat pour trouver le secret du token. Ensuite nous exploiterons une vulnérabilité qui consiste à modifier l'algorithme de hashage  du token et pour finir ...

démo hashcat

démo modifier l'algo en "none" => voire la CVE

démo changer l'algo de asymétrique à symétrique
